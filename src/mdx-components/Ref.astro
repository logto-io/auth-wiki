---
import { getEntry } from "astro:content";
import { Icon } from "astro-icon/components";

type Props = {
  /**
   * The internal slug of the reference. It must be a valid slug of an article loaded in the site.
   * @see 'terms' collection in the 'src/content' directory.
   */
  slug: string;
  /**
   * The optional heading ID to link to. If the article has no heading with the given ID, an error
   * will be thrown.
   */
  headingId?: string;
};

const { slug, headingId } = Astro.props;
const entry = await getEntry("terms", slug);

if (!entry) {
  throw new Error(`The article with slug "${slug}" was not found.`);
}

const headings = await entry.render().then(({ headings }) => headings);
const heading = headings.find((heading) => heading.slug === headingId);

if (headingId && !heading) {
  throw new Error(
    `The heading with ID "${headingId}" was not found in the article with slug "${slug}".`,
  );
}
---

<span>
  <Icon name="document" />
  <a href={`/${slug}${heading ? `#${headingId}` : ""}`}>
    <slot>{heading?.text ?? entry.data.title}</slot>
  </a>
</span>

<style>
  [data-icon="document"] {
    vertical-align: sub;
    height: 1.1em;
    color: var(--color-link);
  }
  a {
    display: inline-block;
  }
</style>
